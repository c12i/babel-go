<!doctype html>
<html lang="en">
  {{ template "head" . }}
  <body class="min-h-screen font-mono text-gray-900 dark:text-parchment">
    {{ template "header" . }}

    <main class="container mx-auto px-3 sm:px-4 py-4 sm:py-6 md:py-8">
      <div class="max-w-5xl mx-auto">
        {{ if not .location }}
        <div class="max-w-3xl mx-auto">
          <div class="border rounded p-4 sm:p-6 md:p-8 bg-white border-gray-200 shadow-sm dark:bg-ink/50 dark:border-aged/20 dark:shadow-none">
            <h1 class="text-xs tracking-[0.3em] text-gray-700 dark:text-aged/60 uppercase mb-4 sm:mb-6 font-semibold">
              Navigate to Location
            </h1>

            <form action="/browse" method="POST" class="space-y-3 sm:space-y-4">
              {{ if .error }}{{ template "errorAlert" . }}{{ end }}
              <div>
                <label
                  for="location"
                  class="block text-gray-700 dark:text-aged/50 text-xs tracking-wider mb-2 font-semibold"
                >
                  HEXAGON.WALL.SHELF.BOOK.PAGE
                </label>
                <input
                  type="text"
                  name="location"
                  id="location"
                  placeholder="e.g., 3a7f.2.1.15.204"
                  class="w-full rounded px-3 py-2 sm:px-4 sm:py-3 font-mono text-xs sm:text-sm focus:outline-none transition-colors border bg-white border-gray-300 text-gray-900 focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 placeholder-gray-400 dark:bg-ink/80 dark:border-aged/30 dark:text-parchment dark:focus:border-aged/60 dark:focus:ring-aged/20 dark:placeholder-aged/30"
                  autofocus
                />
              </div>
              <button
                type="submit"
                class="w-full border px-4 py-2 sm:px-6 sm:py-3 rounded transition-all tracking-widest text-xs sm:text-sm uppercase font-medium bg-blue-600 hover:bg-blue-700 border-blue-600 text-white dark:bg-aged/10 dark:hover:bg-aged/20 dark:border-aged/30 dark:text-aged"
              >
                Navigate
              </button>
            </form>
          </div>
        </div>
        {{ end }} {{ if .location }}
        <div class="space-y-3 sm:space-y-4 md:space-y-6">
          <div class="border rounded p-3 sm:p-4 md:p-6 bg-white border-gray-200 shadow-sm dark:bg-ink/50 dark:border-aged/20 dark:shadow-none">
            <div class="flex items-center justify-between mb-3 sm:mb-4">
              <p class="text-gray-600 dark:text-aged/40 text-xs tracking-widest uppercase font-semibold">
                Location
              </p>
              <button
                onclick="copyLocation()"
                id="copyBtn"
                class="border px-2 sm:px-3 py-1 rounded transition-all text-xs tracking-wider uppercase font-medium bg-gray-100 hover:bg-gray-200 border-gray-300 text-gray-700 dark:bg-aged/10 dark:hover:bg-aged/20 dark:border-aged/30 dark:text-aged"
              >
                Copy Location
              </button>
            </div>
            <p
              id="locationText"
              class="font-mono text-gray-700 dark:text-aged text-xs sm:text-sm mb-3 sm:mb-4 break-all truncate"
              title="{{ .location.String }}"
            >
              {{ .location.String }}
            </p>

            <div
              class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-2 sm:gap-3 md:gap-4 text-xs pt-3 sm:pt-4 border-t border-aged/10"
            >
              <div>
                <span class="text-gray-500 dark:text-aged/40 block mb-1 text-xs font-semibold">Hexagon</span>
                <span
                  class="font-mono text-gray-700 dark:text-aged/80 truncate block max-w-[120px]"
                  title="{{ .location.Hexagon }}"
                  >{{ .location.Hexagon }}</span
                >
              </div>
              <div>
                <span class="text-gray-500 dark:text-aged/40 block mb-1 text-xs font-semibold">Wall</span>
                <span class="font-mono text-gray-700 dark:text-aged/80">{{ .location.Wall }}</span>
              </div>
              <div>
                <span class="text-gray-500 dark:text-aged/40 block mb-1 text-xs font-semibold">Shelf</span>
                <span class="font-mono text-aged-light dark:text-aged/80"
                  >{{ .location.Shelf }}</span
                >
              </div>
              <div>
                <span class="text-gray-500 dark:text-aged/40 block mb-1 text-xs font-semibold">Book</span>
                <span class="font-mono text-gray-700 dark:text-aged/80">{{ .location.Book }}</span>
              </div>
              <div>
                <span class="text-gray-500 dark:text-aged/40 block mb-1 text-xs font-semibold">Page</span>
                <span class="font-mono text-gray-700 dark:text-aged/80">{{ .location.Page }}</span>
              </div>
            </div>
          </div>

          <div class="border rounded p-3 sm:p-4 md:p-6 lg:p-8 shadow-sm bg-white border-gray-200 dark:bg-ink/70 dark:border-aged/30 dark:shadow-2xl">
            <div class="mb-2 sm:mb-3 md:mb-4 pb-2 sm:pb-3 md:pb-4 border-b border-aged/20">
              <p class="text-gray-600 dark:text-aged/40 text-xs tracking-widest uppercase font-semibold">
                Page {{ .location.Page }}
              </p>
            </div>

            <div class="rounded p-2 sm:p-3 md:p-4 lg:p-6 bg-gray-50 dark:bg-parchment/5">
              <pre class="page-content text-gray-900 dark:text-parchment/90">{{ .displayContent }}</pre>
            </div>
          </div>

          <div class="flex flex-col sm:flex-row justify-center items-center gap-3 sm:gap-4 pt-3 sm:pt-4 pb-3 sm:pb-4">
            <form action="/browse" method="POST" class="inline">
              <input type="hidden" name="location" value="{{ .prevLocation.String }}" />
              <button
                type="submit"
                class="border px-4 py-2 sm:px-6 sm:py-2.5 rounded transition-all tracking-wider text-xs sm:text-sm uppercase font-medium bg-gray-100 hover:bg-gray-200 border-gray-300 text-gray-700 dark:bg-aged/10 dark:hover:bg-aged/20 dark:border-aged/30 dark:text-aged"
              >
                ← Previous
              </button>
            </form>

            <form action="/browse" method="POST" class="flex items-center gap-2">
              <span class="text-gray-600 dark:text-aged/50 text-xs font-medium">Page</span>
              <input
                type="number"
                id="pageInput"
                name="page"
                min="1"
                max="410"
                placeholder="{{ .location.Page }}"
                class="w-16 rounded px-2 py-2 font-mono text-xs text-center focus:outline-none transition-colors border bg-white border-gray-300 text-gray-900 focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 dark:bg-ink/80 dark:border-aged/30 dark:text-parchment dark:focus:border-aged/60 dark:focus:ring-aged/20"
              />
              <span class="text-gray-600 dark:text-aged/50 text-xs font-medium">/ 410</span>
              <input type="hidden" name="hexagon" value="{{ .location.Hexagon }}" />
              <input type="hidden" name="wall" value="{{ .location.Wall }}" />
              <input type="hidden" name="shelf" value="{{ .location.Shelf }}" />
              <input type="hidden" name="book" value="{{ .location.Book }}" />
              <button
                type="submit"
                class="border px-3 py-2 rounded transition-all text-xs uppercase font-medium bg-blue-600 hover:bg-blue-700 border-blue-600 text-white dark:bg-aged/10 dark:hover:bg-aged/20 dark:border-aged/30 dark:text-aged"
              >
                Go
              </button>
            </form>

            <form action="/browse" method="POST" class="inline">
              <input type="hidden" name="location" value="{{ .nextLocation.String }}" />
              <button
                type="submit"
                class="border px-4 py-2 sm:px-6 sm:py-2.5 rounded transition-all tracking-wider text-xs sm:text-sm uppercase font-medium bg-gray-100 hover:bg-gray-200 border-gray-300 text-gray-700 dark:bg-aged/10 dark:hover:bg-aged/20 dark:border-aged/30 dark:text-aged"
              >
                Next →
              </button>
            </form>
          </div>

          <div class="flex flex-col sm:flex-row justify-between items-center gap-2 sm:gap-0 pt-3 sm:pt-4 border-t border-aged/10">
            <a
              href="/search"
              class="text-gray-600 hover:text-gray-900 dark:text-aged/60 dark:hover:text-aged transition-colors text-xs sm:text-sm tracking-wider"
            >
              ← Return to Search
            </a>

            <a
              href="/"
              class="text-gray-600 hover:text-gray-900 dark:text-aged/60 dark:hover:text-aged transition-colors text-xs sm:text-sm tracking-wider"
            >
              Return to Library Entrance
            </a>
          </div>
        </div>
        {{ end }}
      </div>
    </main>

    {{ template "footer" . }}

    <script>
      function copyLocation() {
        const locationText = document
          .getElementById("locationText")
          .textContent.trim();
        const copyBtn = document.getElementById("copyBtn");

        navigator.clipboard
          .writeText(locationText)
          .then(() => {
            // Show success feedback
            const originalText = copyBtn.textContent;
            copyBtn.textContent = "Copied!";
            copyBtn.classList.add(
              "bg-green-600/20",
              "border-green-600/50",
              "text-green-400",
            );
            copyBtn.classList.remove(
              "bg-aged/10",
              "border-aged/30",
              "text-aged",
            );

            // Reset after 2 seconds
            setTimeout(() => {
              copyBtn.textContent = originalText;
              copyBtn.classList.remove(
                "bg-green-600/20",
                "border-green-600/50",
                "text-green-400",
              );
              copyBtn.classList.add(
                "bg-aged/10",
                "border-aged/30",
                "text-aged",
              );
            }, 2000);
          })
          .catch((err) => {
            console.error("Failed to copy:", err);
            copyBtn.textContent = "Failed";
            setTimeout(() => {
              copyBtn.textContent = "Copy";
            }, 2000);
          });
      }
    </script>
  </body>
</html>
